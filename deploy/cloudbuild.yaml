substitutions:
  _ARTIFACT_REGISTRY_REPO: docker-repo
  #_VERSION: latest

steps:
  # Docker Build
  - name: gcr.io/cloud-builders/docker
    args:
      [
        build,
        -f,
        docker/python/Dockerfile,
        -t,
        "us-east1-docker.pkg.dev/${PROJECT_ID}/${_ARTIFACT_REGISTRY_REPO}/python:${SHORT_SHA}",
        .,
      ]
    dir: .

  # Docker push to Google Artifact Registry
  - name: gcr.io/cloud-builders/docker
    args:
      [
        push,
        "us-east1-docker.pkg.dev/${PROJECT_ID}/${_ARTIFACT_REGISTRY_REPO}/python:${SHORT_SHA}",
      ]

  - name: gcr.io/cloud-builders/docker
    args:
      [
        build,
        -f,
        docker/bash/Dockerfile,
        -t,
        "us-east1-docker.pkg.dev/${PROJECT_ID}/${_ARTIFACT_REGISTRY_REPO}/bash:${SHORT_SHA}",
        .,
      ]
    dir: .

  # Docker push to Google Artifact Registry
  - name: gcr.io/cloud-builders/docker
    args:
      [
        push,
        "us-east1-docker.pkg.dev/${PROJECT_ID}/${_ARTIFACT_REGISTRY_REPO}/bash:${SHORT_SHA}",
      ]

# Store images in Google Artifact Registry
images:
  - us-east1-docker.pkg.dev/${PROJECT_ID}/${_ARTIFACT_REGISTRY_REPO}/python:${SHORT_SHA}
  - us-east1-docker.pkg.dev/$PROJECT_ID/$_ARTIFACT_REGISTRY_REPO/bash:$SHORT_SHA
